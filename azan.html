<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Время намаза | Ummah Online</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #3d3129;
            --accent-gold: #c2a378;
            --gold-light: #e6d5bc;
            --bg-page: #fdfaf5;
            --white: #ffffff;
            --text-main: #4a3f35;
            --text-muted: #8c8279;
            --card-shadow: 0 15px 40px rgba(61, 49, 41, 0.1);
            --transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * { box-sizing: border-box; }
        
        body { 
            font-family: 'Montserrat', sans-serif; 
            background-color: var(--bg-page); 
            margin: 0; padding: 0; 
            display: flex; flex-direction: column; min-height: 100vh;
            color: var(--text-main);
        }

        .container { max-width: 1000px; margin: 40px auto; padding: 0 20px; flex-grow: 1; width: 100%; }

        .back-btn {
            background: var(--bg-dark);
            color: var(--gold-light);
            border: none;
            padding: 12px 25px;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
            margin-bottom: 30px;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: var(--transition);
        }
        .back-btn:hover { transform: translateX(-5px); background: var(--accent-gold); color: var(--white); }

        .prayer-card {
            background: var(--white);
            border-radius: 30px;
            padding: 60px 40px;
            box-shadow: var(--card-shadow);
            text-align: center;
            border: 1px solid rgba(194, 163, 120, 0.15);
            position: relative;
        }

        .location-title { 
            font-size: 32px; 
            font-weight: 700; 
            color: var(--bg-dark);
            margin-bottom: 8px;
        }
        
        .date-info {
            display: flex;
            flex-direction: column;
            gap: 5px;
            margin-bottom: 40px;
        }
        .hijri-date { color: var(--accent-gold); font-weight: 700; font-size: 18px; }
        .gregorian-date { color: var(--text-muted); font-size: 15px; }

        .prayer-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 20px;
        }

        .prayer-item {
            padding: 30px 15px;
            background: #fff;
            border-radius: 24px;
            border: 1px solid #f7f2eb;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: var(--transition);
            position: relative;
        }

        .visual-icon {
            width: 60px;
            height: 60px;
            margin-bottom: 20px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .icon-circle {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            opacity: 0.15;
            background: var(--accent-gold);
        }

        svg { width: 32px; height: 32px; fill: var(--accent-gold); transition: var(--transition); z-index: 1; }

        .prayer-item.active {
            background: var(--bg-dark);
            border-color: var(--bg-dark);
            transform: translateY(-10px);
            box-shadow: 0 20px 40px rgba(61, 49, 41, 0.2);
        }
        .prayer-item.active .prayer-name { color: var(--gold-light); }
        .prayer-item.active .prayer-time { color: var(--white); }
        .prayer-item.active .icon-circle { background: var(--white); opacity: 0.2; }

        .prayer-name { font-size: 12px; font-weight: 700; text-transform: uppercase; color: var(--text-muted); letter-spacing: 1.5px; margin-bottom: 10px; }
        .prayer-time { font-size: 24px; font-weight: 700; color: var(--bg-dark); }

        .timer-box {
            margin: 0 auto 50px;
            background: #fdfaf5;
            border: 1px solid rgba(194, 163, 120, 0.2);
            padding: 20px 40px;
            border-radius: 20px;
            display: inline-block;
        }
        .timer-label { font-size: 11px; text-transform: uppercase; letter-spacing: 2px; color: var(--text-muted); display: block; margin-bottom: 5px; }
        .timer-val { font-size: 28px; font-weight: 700; color: var(--bg-dark); font-variant-numeric: tabular-nums; }

        footer { background: var(--bg-dark); color: var(--white); padding: 80px 20px 40px; text-align: center; margin-top: 60px; }
        .footer-brand { font-size: 1.5rem; font-weight: 700; letter-spacing: 2px; margin-bottom: 30px; display: block; color: var(--accent-gold); }
        .footer-contacts { display: flex; flex-direction: column; gap: 15px; align-items: center; margin-bottom: 40px; }
        .contact-link { color: var(--gold-light); text-decoration: none; font-size: 14px; display: flex; align-items: center; gap: 10px; transition: var(--transition); padding: 8px 16px; border: 1px solid rgba(194, 163, 120, 0.2); border-radius: 50px; }
        .contact-link:hover { background: var(--accent-gold); color: var(--bg-dark); border-color: var(--accent-gold); }
        .copyright { font-size: 11px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; }

        @media (max-width: 768px) {
            .prayer-grid { grid-template-columns: 1fr; }
            .prayer-item { flex-direction: row; justify-content: space-between; padding: 20px 30px; }
            .visual-icon { margin-bottom: 0; width: 45px; height: 45px; }
        }
    </style>
</head>
<body>

<div class="container">
    <a href="index.html" class="back-btn">
        <svg viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z"/></svg>
        Назад
    </a>

    <div class="prayer-card">
        <div class="location-title" id="city-name">Определение города...</div>
        <div class="date-info">
            <div class="hijri-date" id="hijri-display">...</div>
            <div class="gregorian-date" id="date-display">...</div>
        </div>

        <div class="timer-box">
            <span class="timer-label" id="next-prayer-label">Загрузка данных</span>
            <span class="timer-val" id="countdown">00:00:00</span>
        </div>

        <div class="prayer-grid">
            <div class="prayer-item" id="item-Fajr">
                <div class="visual-icon"><div class="icon-circle"></div><svg viewBox="0 0 24 24"><path d="M6.76 4.84L5 3.05L3.59 4.46L5.38 6.25L6.76 4.84M12 1L11 4H13L12 1M19.16 3.05L17.24 4.84L18.62 6.25L20.41 4.46L19.16 3.05M2 10.5V12.5H5V10.5H2M19 10.5V12.5H22V10.5H19M12 6C8.13 6 5 9.13 5 13H19C19 9.13 15.87 6 12 6M2 14.5C2 17.5 4.5 20 7.5 20H16.5C19.5 20 22 17.5 22 14.5H2Z"/></svg></div>
                <span class="prayer-name">Фаджр</span>
                <span class="prayer-time" id="fajr">--:--</span>
            </div>
            <div class="prayer-item" id="item-Dhuhr">
                <div class="visual-icon"><div class="icon-circle"></div><svg viewBox="0 0 24 24"><path d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4M12,6V12L16,14L16.8,12.7L13.5,10.8V6H12Z"/></svg></div>
                <span class="prayer-name">Зухр</span>
                <span class="prayer-time" id="dhuhr">--:--</span>
            </div>
            <div class="prayer-item" id="item-Asr">
                <div class="visual-icon"><div class="icon-circle"></div><svg viewBox="0 0 24 24"><path d="M12 2L4.5 20.29l.71.71L12 18l6.79 3 .71-.71z"/></svg></div>
                <span class="prayer-name">Аср</span>
                <span class="prayer-time" id="asr">--:--</span>
            </div>
            <div class="prayer-item" id="item-Maghrib">
                <div class="visual-icon"><div class="icon-circle"></div><svg viewBox="0 0 24 24"><path d="M12,3C7.03,3 3,7.03 3,12C3,16.97 7.03,21 12,21C16.97,21 21,16.97 21,12C21,7.03 16.97,3 12,3M12,19C8.13,19 5,15.87 5,12C5,8.13 8.13,5 12,5C15.87,5 19,8.13 19,12C19,15.87 15.87,19 12,19M12,7V12H17V13.5H10.5V7H12Z"/></svg></div>
                <span class="prayer-name">Магриб</span>
                <span class="prayer-time" id="maghrib">--:--</span>
            </div>
            <div class="prayer-item" id="item-Isha">
                <div class="visual-icon"><div class="icon-circle"></div><svg viewBox="0 0 24 24"><path d="M17.75,4.09L15.22,6.03L16.13,9.09L13.5,7.28L10.87,9.09L11.78,6.03L9.25,4.09L12.44,4.03L13.5,1L14.56,4.03L17.75,4.09M18.97,15.95C17.14,15.95 15.46,15.34 14.05,14.3C15.4,12.45 15.86,10.12 15.13,7.82C17.64,9.23 19.39,11.88 19.39,14.96C19.39,15.3 19.37,15.63 19.32,15.96C19.2,15.95 19.09,15.95 18.97,15.95M17.33,17.97C14.5,17.81 11.7,16.64 9.53,14.5C6.12,11.11 4.96,6.47 5.82,2.12C4.03,4.1 3,6.69 3,9.5C3,15.3 7.7,20 13.5,20C14.95,20 16.31,19.71 17.54,19.17C17.47,18.77 17.43,18.37 17.33,17.97Z"/></svg></div>
                <span class="prayer-name">Иша</span>
                <span class="prayer-time" id="isha">--:--</span>
            </div>
        </div>
    </div>
</div>

<footer>
    <div class="footer-content">
        <span class="footer-brand">UMMAH ONLINE</span>
        <div class="footer-contacts">
            <a href="mailto:umar@ummahonline.org" class="contact-link">
                <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/></svg>
                umar@ummahonline.org
            </a>
            <a href="https://t.me/ummahonline" target="_blank" class="contact-link">
                <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm4.64 6.8c-.15 1.58-.8 5.42-1.13 7.19-.14.75-.42 1-.68 1.03-.58.05-1.02-.38-1.58-.75-.88-.58-1.38-.94-2.23-1.5-.99-.65-.35-1.01.22-1.59.15-.15 2.71-2.48 2.76-2.69a.2.2 0 00-.05-.18c-.06-.05-.14-.03-.21-.02-.09.02-1.49.95-4.22 2.79-.4.27-.76.41-1.08.4-.36-.01-1.04-.2-1.55-.37-.63-.2-1.12-.31-1.08-.66.02-.18.27-.36.74-.55 2.92-1.27 4.86-2.11 5.83-2.51 2.78-1.16 3.35-1.36 3.73-1.36.08 0 .27.02.39.12.1.08.13.19.14.27-.01.06.01.24 0 .33z"/></svg>
                t.me/ummahonline
            </a>
        </div>
        <p class="copyright">&copy; 2026 Ummah Online. Все права защищены.</p>
    </div>
</footer>

<script>
    const prayerNamesRu = { Fajr: "Фаджр", Dhuhr: "Зухр", Asr: "Аср", Maghrib: "Магриб", Isha: "Иша" };
    let prayerTimes = {};

    async function fetchData(lat, lon) {
        try {
            const prayerUrl = `https://api.aladhan.com/v1/timings?latitude=${lat}&longitude=${lon}&method=3`;
            const res = await fetch(prayerUrl);
            const data = await res.json();
            const t = data.data.timings;
            const h = data.data.date.hijri;

            prayerTimes = { Fajr: t.Fajr, Dhuhr: t.Dhuhr, Asr: t.Asr, Maghrib: t.Maghrib, Isha: t.Isha };

            for (let key in prayerTimes) {
                const el = document.getElementById(key.toLowerCase());
                if (el) el.innerText = prayerTimes[key];
            }

            document.getElementById('hijri-display').innerText = `${h.day} ${h.month.en} ${h.year} AH`;
            document.getElementById('date-display').innerText = new Date().toLocaleDateString('ru-RU', { weekday: 'long', day: 'numeric', month: 'long' });
            
            const geoUrl = `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}&accept-language=ru`;
            const cityRes = await fetch(geoUrl);
            const cityData = await cityRes.json();
            
            document.getElementById('city-name').innerText = cityData.address.city || cityData.address.town || cityData.address.village || cityData.address.state || "Ваш город";

            updateTimer();
        } catch (e) {
            console.error(e);
            document.getElementById('city-name').innerText = "Ошибка загрузки";
        }
    }

    // Вторичный метод определения по IP, если GPS недоступен
    async function fetchByIP() {
        try {
            const res = await fetch('https://ipapi.co/json/');
            const data = await res.json();
            fetchData(data.latitude, data.longitude);
        } catch (e) {
            // Если и IP не сработал, тогда только Москва как последний вариант
            fetchData(55.7558, 37.6173);
        }
    }

    function updateTimer() {
        setInterval(() => {
            if (!Object.keys(prayerTimes).length) return;
            const now = new Date();
            let nextKey = null;
            let minDiff = Infinity;
            let lastPassedKey = null;

            const parse = (timeStr) => {
                const [h, m] = timeStr.split(':').map(Number);
                const d = new Date(); d.setHours(h, m, 0, 0); return d;
            };

            const keys = ["Fajr", "Dhuhr", "Asr", "Maghrib", "Isha"];
            keys.forEach(key => {
                const time = parse(prayerTimes[key]);
                const diff = time - now;
                if (diff <= 0) lastPassedKey = key;
                if (diff > 0 && diff < minDiff) { minDiff = diff; nextKey = key; }
            });

            if (!nextKey) {
                nextKey = "Fajr";
                const time = parse(prayerTimes.Fajr);
                time.setDate(time.getDate() + 1);
                minDiff = time - now;
            }

            const h = Math.floor(minDiff / 3600000);
            const m = Math.floor((minDiff % 3600000) / 60000);
            const s = Math.floor((minDiff % 60000) / 1000);
            document.getElementById('countdown').innerText = `${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}`;
            document.getElementById('next-prayer-label').innerText = `До намаза ${prayerNamesRu[nextKey]}`;

            document.querySelectorAll('.prayer-item').forEach(el => el.classList.remove('active'));
            if (lastPassedKey) {
                document.getElementById(`item-${lastPassedKey}`).classList.add('active');
            } else {
                document.getElementById('item-Isha').classList.add('active');
            }
        }, 1000);
    }

    window.onload = () => {
        if (navigator.geolocation) {
            // Пытаемся получить GPS. Таймаут 5 секунд, чтобы не ждать вечно
            navigator.geolocation.getCurrentPosition(
                p => fetchData(p.coords.latitude, p.coords.longitude),
                () => fetchByIP(), // Если отказали в GPS или ошибка, идем к IP
                { timeout: 5000 }
            );
        } else {
            fetchByIP();
        }
    };
</script>

</body>
</html>